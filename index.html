<!doctype html>
<html lang="en" style="width: 100%; height: 100%;">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
      
    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">

      
    <script type='text/javascript' src='https://www.x3dom.org/download/x3dom.js'> </script>
    <link rel='stylesheet' type='text/css' href='https://www.x3dom.org/download/x3dom.css'/>

    <title>Virtual 3D Model</title>
  </head>
  <body style="height: 100%; width: 100%; background-color: rgb(178,178,178);">
    <div class="container-fluid p-0 m-0">
        <div class="row p-0 m-0">
            <div class="col p-0 m-0">
                <x3d style="height: 100%; width: 100%; border:0; margin:0; padding:0;" id="boxes" showstat="false" showlog="false">
                    <scene def="scene" children='X3DChildNode' metadata='X3DMetadataObject' render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" pickmode="idBuf" dopickpass="true">
                    <!--<navigationInfo id="head" headlight='true' type='"EXAMINE"'></navigationInfo>
                    <background  skyColor="0 0 0"></background>-->
                    <Viewpoint id="front" position='-0.3856 1.0668 -21.2951' orientation='-0.0145 0.9999 0.0032 3.1583' description="camera"></Viewpoint>
                    <Viewpoint id="right" position='-21.1975 2.7566 1.7076' orientation='-0.0165 -0.9971 -0.0743 1.4984' description="camera"></Viewpoint>
                    <Viewpoint id="left" position='20.6631 1.8545 -3.5693' orientation='-0.0821 0.9961 -0.0318 1.7372' description="camera"></Viewpoint>
                    <Viewpoint id="top" position='0.3552 20.3666 -12.1232' orientation='-0.0031 0.8747 0.4847 3.1204' description="camera"></Viewpoint>

                    <directionalLight id="directional" direction='0 -1 0' on ="TRUE" intensity='2.0' shadowIntensity='0.0'>
                    </directionalLight>
                    <PointLight id='point' on='TRUE' intensity='0.9000' ambientIntensity='0.0000' color='0.0 0.6 0.0' location='2 10 0.5 '  attenuation='0 0 0' radius='5.0000'> </PointLight>
                    <SpotLight id='spot' on ="TRUE" beamWidth='0.9' color='0 0 1' cutOffAngle='0.78' location='0 0 12' radius='22'></SpotLight>
                        
                     

                    <Group id="shape_container" onmousemove="updateStuff(event);">
                        <Transform id="shape_transform" rotation="0 0 1 0">
                        <!-- Fossil -->
                            <inline id="box_2_id" bboxCenter='0,0,0' bboxSize='-1,-1,-1' children='X3DChildNode' load='true' mapDEFToID='true' metadata='X3DMetadataObject' nameSpaceName='[]' render='true' url="untitled2.x3d">
                                <Background DEF="WO_World" groundColor="0.7 0.7 0.7" skyColor="0.7 0.7 0.7" groundAngle="" skyAngle="" backUrl="" bottomUrl="" frontUrl="" leftUrl="" rightUrl="" topUrl="" id="[]__WO_World"></Background>    
                            </inline>
                        </Transform>
                    </Group>

                    <!-- EXAMPLE GROUND PLANE, FOR BETTER ORIENTATION -->
                    <Transform translation="0 -1 0" rotation="1 0 0 -1.57" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" center="0,0,0" scale="1,1,1" scaleorientation="0,0,0,0">
                        <shape render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" ispickable="true">
                                <appearance sorttype="auto" alphaclipthreshold="0.1"><material diffusecolor="0.5 0.5 0.5" ambientintensity="0.2" shininess="0.2" specularcolor="0.2,0.2,0.2"></material></appearance>                    
                                <plane solid="false" size="16 16" ccw="true" usegeocache="true" lit="true" subdivision="1,1" center="0,0,0" primtype="TRIANGLES "></plane>
                            </shape>
                   </Transform>

                    <!-- Bar for mouse cursor icon -->
                    <Transform id="bar" translation="0 0 0">
                      <Transform id="foo" scale=".1 .4 .1" translation="0 -0.4 0">
                        <Shape isPickable="false" DEF="float">
                            <Appearance>
                                <Material diffuseColor="olivedrab" specularColor="peachpuff"></Material>
                            </Appearance>
                            <Cone></Cone>
                        </Shape>
                      </Transform>
                    </Transform>

                        
                    
                        
                    </scene>
                </x3d>
    <!--          
    <button  onclick="document.getElementById('right').setAttribute('set_bind','true');" style="border: none; background: transparent; position: fixed; font-size: 3em;z-index: 100;left:125px;bottom:75px;"><i class="fas fa-chevron-circle-right"></i></button>
    <button onclick="document.getElementById('left').setAttribute('set_bind','true');" style="border: none; background: transparent; position: fixed; font-size: 3em;z-index: 100;left: 25px; bottom: 75px;"><i class="fas fa-chevron-circle-left"></i></button>
    <button  onclick="document.getElementById('front').setAttribute('set_bind','true');" style="border: none; background: transparent; position: fixed; font-size: 3em;z-index: 100;bottom: 25px; left: 75px;"><i class="fas fa-chevron-circle-down"></i></button>
    <button  onclick="document.getElementById('top').setAttribute('set_bind','true');" style="border: none; background: transparent; position: fixed; font-size: 3em;z-index: 100; bottom: 125px; left: 75px;"><i class="fas fa-chevron-circle-up"></i></button>
    -->
      
    <div id="logprev1" style="clear: both; padding: 2px; color: #00ff00; background-color: black; position: fixed; right: 25px; bottom: 0px; width: 200px; display: none;">
                  <p id="moveEvent" > ==&gt; Drag the red box around with your mouse! 
                      Use left button for pane and right for zoom. </p>
                  <!--<p id="mouseOverEvent" > ==&gt; Move your mouse over the little primitives to update the markers. </p>-->
                  <p id="viewMat" > &nbsp; </p>
                </div>
      
    <span id="anno2d" style="position: absolute; background-color: blue; color: yellow; border: yellow solid 1px; z-index: 99; padding: 6px; margin: 2px; width: 60px; height: 30 px; opacity: 0.7; text_align: center; top: 6px; left: 6px; display: none;">
        Annotation</span>
    
    <div style="position: fixed; bottom: 50px; left: 34%; text-align: center;">
        <div class="btn-group mr-2" role="group" aria-label="First group">
            <button onclick="document.getElementById('top').setAttribute('set_bind','true');" type="button" class="btn btn-secondary">Top</button>
            <button onclick="document.getElementById('left').setAttribute('set_bind','true');" type="button" class="btn btn-secondary">Left</button>
            <button onclick="document.getElementById('front').setAttribute('set_bind','true');" type="button" class="btn btn-secondary">Front</button>
            <button onclick="document.getElementById('right').setAttribute('set_bind','true');" type="button" class="btn btn-secondary">Right</button>
        </div>
        <br>
        <img class="mt-2" width="auto" height="50" src="assets/Asset%201.svg">
        <br>
        <h6>Move</h6>
    </div>
    <div style="position: fixed; bottom: 50px; left: 52%; text-align: center;">
        <div class="btn-group mr-2" role="group" aria-label="Second group">
            <button onclick="vertical()" type="button" class="btn btn-secondary">Vertical</button>
            <button onclick="horizontal()" type="button" class="btn btn-secondary">Horizontal</button>
        </div>
        <br>
        <img class="mt-2" width="auto" height="50" src="assets/Asset%202.svg">
        <br>
        <h6>Rotate</h6>
    </div>
                
    <div class="card" style="position:fixed; top: 50px; left: 50px; width: 300px;">
      <div class="card-header">
        <i class="fas fa-robot"></i> DinoTutor 
        <span class="float-right">
            <i id="minimize_icon" onclick="minimize_discussion()" class="fas fa-window-minimize"></i>
            <i id="maximize_icon" onclick="maximize_discussion()" class="fas fa-window-maximize" style="display: none;"></i>
        </span>
      </div>
      <div id="discussion_thread" class="card-body" style="height: 200px; overflow-y: scroll;">
          <div class="card mr-3 mt-1">
              <div class="card-body">
                This is some prompt delivered by the tutor.
              </div>
          </div>
          <div class="card ml-3 mt-1">
              <div class="card-body">
                This is some response by the student.
              </div>
          </div>
      </div>
      <div id="discussion_input" class="card-body">
          <textarea id="discussion_textarea" class="form-control" rows="2"></textarea>
          <button onclick="discussion_respond()" type="button" class="btn btn-secondary mt-1">Submit</button>
      </div>
    </div>
                
    <!-- Debug Controls -->
    <div onclick="toggle_debugcontrols()" style="position: fixed; font-size: 3em; top: 50px; right: 50px; z-index: 100; color: lightgray;">
        <i class="fas fa-wrench"></i>
    </div>
                
            </div>
        </div> 
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
      
    <script>
        
    
    // the x3dom runtime object
    var runtime = null;
    var drag = true;


    // on button press
    function start(event) 
    {
        if (!drag) {
            document.getElementById('moveEvent').innerHTML = "Down: [" + event.layerX + " | " + event.layerY + "]";
            drag = true;
        }
    }

    // on mouse move
    function moveCallback(elem, trans)
    {
        document.getElementById('moveEvent').innerHTML = "Move " + elem.id + ": [" + trans + "]";
    }

    // on button release
    function stop(event)
    {
        if (drag) {
            document.getElementById('moveEvent').innerHTML = "Up: [" + event.layerX + " | " + event.layerY + "]";
            drag = false;
        }
    }
    
    // viewpoint changed
    function viewFunc(evt)
    {
        // show viewpoint values
        if (evt)
        {
        	var pos = evt.position;
        	var rot = evt.orientation;
    		var mat = evt.matrix;
		
            var camPos = pos.x.toFixed(4)+' '+pos.y.toFixed(4)+' '+pos.z.toFixed(4);
            var camRot = rot[0].x.toFixed(4)+' '+rot[0].y.toFixed(4)+' '+rot[0].z.toFixed(4)+' '+rot[1].toFixed(4);
        
            document.getElementById("viewMat").innerHTML = "&ltViewpoint position='" + 
                                                            camPos + "' orientation='" + camRot + "'&gt";
        }
        
        // update 2d marker also if camera changes since projection is now wrong
        var trans = x3dom.fields.SFVec3f.parse(document.getElementById('bar').getAttribute("translation"));
	    var pos2d = runtime.calcPagePos(trans.x, trans.y, trans.z);
        var anno = document.getElementById("anno2d");
        
        anno.innerHTML = "(" + pos2d[0] + ", " + pos2d[1] + ")";
        anno.style.left = (pos2d[0]+1) + "px";
        anno.style.top = (pos2d[1]+1) + "px";
    }
    
    // update position and orientation of line according to picked position and surface direction
    function updateStuff(event)
    {
        var norm = new x3dom.fields.SFVec3f(event.normalX, event.normalY, event.normalZ);
        var qDir = x3dom.fields.Quaternion.rotateFromTo(new x3dom.fields.SFVec3f(0, -1, 0), norm);
        var rot = qDir.toAxisAngle();
        
        var t = document.getElementById('bar');
        t.setAttribute('rotation', rot[0].x+' '+rot[0].y+' '+rot[0].z+' '+rot[1]);
        t.setAttribute('translation', event.worldX+' '+event.worldY+' '+event.worldZ);
        
        var pos2d = runtime.calcPagePos(event.worldX, event.worldY, event.worldZ);
        var anno = document.getElementById("anno2d");
        
        anno.innerHTML = "(" + pos2d[0] + ", " + pos2d[1] + ")";
        anno.style.left = (pos2d[0]+1) + "px";
        anno.style.top = (pos2d[1]+1) + "px";
    }

    // some inits to attach listeners etc.
    document.onload = function() 
    {
        var boxes = document.getElementById("boxes");
        runtime = boxes.runtime;
        boxes.addEventListener('mouseup', stop, false);
        
        var redBox = document.getElementById("box_2_id");
        redBox.addEventListener('mousedown', start, false);

        // Moveable wrapper requires x3dom-full.js, its signature is:
        // x3dom.Moveable(x3domElement, transformNode, callback, snapToGridSize)
        new x3dom.Moveable(boxes, redBox, moveCallback, 0);
        
        document.getElementById('front').addEventListener('viewpointChanged', viewFunc, false);
        document.getElementById('right').addEventListener('viewpointChanged', viewFunc, false);
        document.getElementById('left').addEventListener('viewpointChanged', viewFunc, false);
        document.getElementById('top').addEventListener('viewpointChanged', viewFunc, false);
        viewFunc(null);
    }  
        
    function vertical(){
        console.log("vertical() ready...");
        var position = document.getElementById("shape_transform").getAttribute('rotation');
        console.log(position);
        var positionparse = position.split(" ");
        console.log(positionparse);
        positionparse[0] = "1";
        positionparse[1] = "0";
        positionparse[2] = "0";
        positionparse[3] = String(Number(positionparse[3]) + Number(-0.78));
        var newposition = positionparse.join(" ");
        console.log(newposition);
        document.getElementById("shape_container").innerHTML = `
            <Transform id="shape_transform" rotation="`+newposition+`">
                        <!-- Fossil -->
                            <inline id="box_2_id" bboxCenter='0,0,0' bboxSize='-1,-1,-1' children='X3DChildNode' load='true' mapDEFToID='true' metadata='X3DMetadataObject' nameSpaceName='[]' render='true' url="untitled2.x3d">
                                <Background DEF="WO_World" groundColor="0.7 0.7 0.7" skyColor="0.7 0.7 0.7" groundAngle="" skyAngle="" backUrl="" bottomUrl="" frontUrl="" leftUrl="" rightUrl="" topUrl="" id="[]__WO_World"></Background>    
                            </inline>
                        </Transform>                
        `;
    }
        
    function horizontal(){
        console.log("horizontal() ready...");
        var position = document.getElementById("shape_transform").getAttribute('rotation');
        console.log(position);
        var positionparse = position.split(" ");
        console.log(positionparse);
        positionparse[0] = "0";
        positionparse[1] = "1";
        positionparse[2] = "0";
        positionparse[3] = String(Number(positionparse[3]) + Number(-0.78));
        var newposition = positionparse.join(" ");
        console.log(newposition);
        document.getElementById("shape_container").innerHTML = `
            <Transform id="shape_transform" rotation="`+newposition+`">
                        <!-- Fossil -->
                            <inline id="box_2_id" bboxCenter='0,0,0' bboxSize='-1,-1,-1' children='X3DChildNode' load='true' mapDEFToID='true' metadata='X3DMetadataObject' nameSpaceName='[]' render='true' url="untitled2.x3d">
                                <Background DEF="WO_World" groundColor="0.7 0.7 0.7" skyColor="0.7 0.7 0.7" groundAngle="" skyAngle="" backUrl="" bottomUrl="" frontUrl="" leftUrl="" rightUrl="" topUrl="" id="[]__WO_World"></Background>    
                            </inline>
                        </Transform>                
        `;
        
    }
        
    function minimize_discussion(){
        document.getElementById("discussion_thread").style.display = "none";
        document.getElementById("discussion_input").style.display = "none";
        document.getElementById("minimize_icon").style.display = "none";
        document.getElementById("maximize_icon").style.display = "block";
    }
        
    function maximize_discussion(){
        document.getElementById("discussion_thread").style.display = "block";
        document.getElementById("discussion_input").style.display = "block";
        document.getElementById("minimize_icon").style.display = "block";
        document.getElementById("maximize_icon").style.display = "none";
    }
        
    function discussion_respond(){
        var value = document.getElementById("discussion_textarea").value;
        var element = document.getElementById("discussion_thread");
        element.innerHTML +=         
        `<div class="card ml-3 mt-1">
              <div class="card-body">`
                +value+
              `</div>
          </div>`;
    }
        
    function toggle_debugcontrols(){
        if(document.getElementById("logprev1").style.display == "none"){
            document.getElementById("logprev1").style.display = "block";    
        }else{
            document.getElementById("logprev1").style.display = "none";
        }
        
        if(document.getElementById("anno2d").style.display == "none"){
            document.getElementById("anno2d").style.display = "block";
        }else{
            document.getElementById("anno2d").style.display = "none";
        }
    }
        
    </script>
  </body>
</html>




<!--
<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
        <title>Virtual 3D Model</title>
        <script type='text/javascript' src='https://www.x3dom.org/download/x3dom.js'> </script>
        <link rel='stylesheet' type='text/css' href='https://www.x3dom.org/download/x3dom.css'/>
    </head>
    <body>
    <x3d style="height: 100%; width: 100%; border:0; margin:0; padding:0;" id="boxes" showstat="true" showlog="true" width='1080px' height='740px'>
        <scene def="scene" children='X3DChildNode' metadata='X3DMetadataObject' render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" pickmode="idBuf" dopickpass="true">
        <!--<navigationInfo id="head" headlight='true' type='"EXAMINE"'></navigationInfo>
        <background  skyColor="0 0 0"></background>
        <Viewpoint id="front" position='-0.3856 1.0668 -21.2951' orientation='-0.0145 0.9999 0.0032 3.1583' description="camera"></Viewpoint>
        <Viewpoint id="right" position='-21.1975 2.7566 1.7076' orientation='-0.0165 -0.9971 -0.0743 1.4984' description="camera"></Viewpoint>
        <Viewpoint id="left" position='20.6631 1.8545 -3.5693' orientation='-0.0821 0.9961 -0.0318 1.7372' description="camera"></Viewpoint>
        <Viewpoint id="top" position='0.3552 20.3666 -12.1232' orientation='-0.0031 0.8747 0.4847 3.1204' description="camera"></Viewpoint>
            
        <directionalLight id="directional" direction='0 -1 0' on ="TRUE" intensity='2.0' shadowIntensity='0.0'>
        </directionalLight>
        <PointLight id='point' on='TRUE' intensity='0.9000' ambientIntensity='0.0000' color='0.0 0.6 0.0' location='2 10 0.5 '  attenuation='0 0 0' radius='5.0000'> </PointLight>
        <SpotLight id='spot' on ="TRUE" beamWidth='0.9' color='0 0 1' cutOffAngle='0.78' location='0 0 12' radius='22'></SpotLight>
           
        <Group onmousemove="updateStuff(event);">
            <!-- Fossil 
            <inline id="box_2_id" bboxCenter='0,0,0' bboxSize='-1,-1,-1' children='X3DChildNode' load='true' mapDEFToID='true' metadata='X3DMetadataObject' nameSpaceName='[]' render='true' url="untitled2.x3d">
                <Background DEF="WO_World" groundColor="0.7 0.7 0.7" skyColor="0.7 0.7 0.7" groundAngle="" skyAngle="" backUrl="" bottomUrl="" frontUrl="" leftUrl="" rightUrl="" topUrl="" id="[]__WO_World"></Background>    
            </inline>
        </Group>
            
        <!-- EXAMPLE GROUND PLANE, FOR BETTER ORIENTATION 
        <Transform translation="0 -1 0" rotation="1 0 0 -1.57" render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" center="0,0,0" scale="1,1,1" scaleorientation="0,0,0,0">
            <shape render="true" bboxcenter="0,0,0" bboxsize="-1,-1,-1" ispickable="true">
                    <appearance sorttype="auto" alphaclipthreshold="0.1"><material diffusecolor="0.5 0.5 0.5" ambientintensity="0.2" shininess="0.2" specularcolor="0.2,0.2,0.2"></material></appearance>                    
                    <plane solid="false" size="16 16" ccw="true" usegeocache="true" lit="true" subdivision="1,1" center="0,0,0" primtype="TRIANGLES "></plane>
                </shape>
       </Transform>
            
        <!-- Bar for mouse cursor icon 
        <Transform id="bar" translation="0 0 0">
          <Transform id="foo" scale=".1 .4 .1" translation="0 -0.4 0">
			<Shape isPickable="false" DEF="float">
				<Appearance>
					<Material diffuseColor="olivedrab" specularColor="peachpuff"></Material>
				</Appearance>
				<Cone></Cone>
			</Shape>
		  </Transform>
        </Transform>

        </scene>
    </x3d>
    <div id="camera_buttons" style="display: block;">
        <button  onclick="document.getElementById('right').setAttribute('set_bind','true');" style="border: none; background: transparent; display: block">Right<br><img src="camera.png"></button>
        <button onclick="document.getElementById('left').setAttribute('set_bind','true');" style="border: none; background: transparent; display: block">Left <br><img src="camera.png"></button>
        <button  onclick="document.getElementById('front').setAttribute('set_bind','true');" style="border: none; background: transparent; display: block">Front<br><img src="camera.png"></button>
        <button  onclick="document.getElementById('top').setAttribute('set_bind','true');" style="border: none; background: transparent; display: block">Top<br><img src="camera.png"></button>
    </div>
    <div style="clear: both; padding: 2px; color: #00ff00; background-color: black; width: 798px;">
      <p id="moveEvent" > ==&gt; Drag the red box around with your mouse! 
          Use left button for pane and right for zoom. </p>
      <p id="mouseOverEvent" > ==&gt; Move your mouse over the little primitives to update the markers. </p>
      <p id="viewMat" > &nbsp; </p>
    </div>
    <span id="anno2d" style="position: absolute; background-color: blue; color: yellow; border: yellow solid 1px; z-index: 99; padding: 6px; margin: 2px; width: 60px; height: 30 px; opacity: 0.7; text_align: center; top: 6px; left: 6px;">
        Annotation</span>
</body>
    
<script>
    
    // the x3dom runtime object
    var runtime = null;
    var drag = true;


    // on button press
    function start(event) 
    {
        if (!drag) {
            document.getElementById('moveEvent').innerHTML = "Down: [" + event.layerX + " | " + event.layerY + "]";
            drag = true;
        }
    }

    // on mouse move
    function moveCallback(elem, trans)
    {
        document.getElementById('moveEvent').innerHTML = "Move " + elem.id + ": [" + trans + "]";
    }

    // on button release
    function stop(event)
    {
        if (drag) {
            document.getElementById('moveEvent').innerHTML = "Up: [" + event.layerX + " | " + event.layerY + "]";
            drag = false;
        }
    }
    
    // viewpoint changed
    function viewFunc(evt)
    {
        // show viewpoint values
        if (evt)
        {
        	var pos = evt.position;
        	var rot = evt.orientation;
    		var mat = evt.matrix;
		
            var camPos = pos.x.toFixed(4)+' '+pos.y.toFixed(4)+' '+pos.z.toFixed(4);
            var camRot = rot[0].x.toFixed(4)+' '+rot[0].y.toFixed(4)+' '+rot[0].z.toFixed(4)+' '+rot[1].toFixed(4);
        
            document.getElementById("viewMat").innerHTML = "&ltViewpoint position='" + 
                                                            camPos + "' orientation='" + camRot + "'&gt";
        }
        
        // update 2d marker also if camera changes since projection is now wrong
        var trans = x3dom.fields.SFVec3f.parse(document.getElementById('bar').getAttribute("translation"));
	    var pos2d = runtime.calcPagePos(trans.x, trans.y, trans.z);
        var anno = document.getElementById("anno2d");
        
        anno.innerHTML = "(" + pos2d[0] + ", " + pos2d[1] + ")";
        anno.style.left = (pos2d[0]+1) + "px";
        anno.style.top = (pos2d[1]+1) + "px";
    }
    
    // update position and orientation of line according to picked position and surface direction
    function updateStuff(event)
    {
        var norm = new x3dom.fields.SFVec3f(event.normalX, event.normalY, event.normalZ);
        var qDir = x3dom.fields.Quaternion.rotateFromTo(new x3dom.fields.SFVec3f(0, -1, 0), norm);
        var rot = qDir.toAxisAngle();
        
        var t = document.getElementById('bar');
        t.setAttribute('rotation', rot[0].x+' '+rot[0].y+' '+rot[0].z+' '+rot[1]);
        t.setAttribute('translation', event.worldX+' '+event.worldY+' '+event.worldZ);
        
        var pos2d = runtime.calcPagePos(event.worldX, event.worldY, event.worldZ);
        var anno = document.getElementById("anno2d");
        
        anno.innerHTML = "(" + pos2d[0] + ", " + pos2d[1] + ")";
        anno.style.left = (pos2d[0]+1) + "px";
        anno.style.top = (pos2d[1]+1) + "px";
    }

    // some inits to attach listeners etc.
    document.onload = function() 
    {
        var boxes = document.getElementById("boxes");
        runtime = boxes.runtime;
        boxes.addEventListener('mouseup', stop, false);
        
        var redBox = document.getElementById("box_2_id");
        redBox.addEventListener('mousedown', start, false);

        // Moveable wrapper requires x3dom-full.js, its signature is:
        // x3dom.Moveable(x3domElement, transformNode, callback, snapToGridSize)
        new x3dom.Moveable(boxes, redBox, moveCallback, 0);
        
        document.getElementById('front').addEventListener('viewpointChanged', viewFunc, false);
        document.getElementById('right').addEventListener('viewpointChanged', viewFunc, false);
        document.getElementById('left').addEventListener('viewpointChanged', viewFunc, false);
        document.getElementById('top').addEventListener('viewpointChanged', viewFunc, false);
        viewFunc(null);
    }
    
</script>
</html>
-->
